<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Diego Footvolley Open - Overlay</title>
    <style>
        /*
        SAN DIEGO FOOTVOLLEY OPEN - BRANDED OVERLAY
        
        Tournament branding with four-corner layout:
        - Top Left: Scoreboard with OPEN logo
        - Top Right: Host logos (SDFTV + NFA)
        - Bottom Left: Tournament info with division selector
        - Bottom Right: Rotating sponsors
        */
        
        @font-face {
            font-family: 'DayPosterBlack';
            src: url('/fonts/DAYPBL__.TTF') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'AcuminVariable';
            src: url('/fonts/Acumin-Variable-Concept.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: 'AcuminVariable', 'Segoe UI', sans-serif;
            overflow: hidden;
            color: white;
            width: 100vw;
            height: 100vh;
        }

        .overlay-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
        }

        /* BRANDING COLORS FROM MANUAL */
        :root {
            --primary-pink: #FF6B9D;
            --primary-orange: #FF8A3D;
            --primary-yellow: #FFD93D;
            --primary-green: #6BCF7F;
            --primary-blue: #4F9BFF;
            --primary-purple: #9B7BFF;
            --dark-bg: rgba(0,0,0,0.9);
            --light-bg: rgba(255,255,255,0.95);
        }

        /* TOP LEFT: OPEN LOGO + NFA LOGO SIDE BY SIDE - ALIGNED HEIGHT */
        .open-logo-topleft {
            position: absolute;
            top: 2vh; /* Aligned with tournament info */
            left: 2vw;
            z-index: 50;
            display: flex;
            align-items: center;
            gap: 15px; /* Space between logos */
        }

        .open-logo-topleft .open-logo {
            max-width: 246px; /* Increased from 224px by 10% */
            max-height: 325px; /* Increased from 295px by 10% */
            object-fit: contain;
            filter: drop-shadow(2px 2px 6px rgba(0,0,0,0.6));
        }

        .open-logo-topleft .nfa-logo {
            max-width: 107px; /* Increased from 97px by 10% */
            max-height: 107px; /* Increased from 97px by 10% */
            object-fit: contain;
            filter: drop-shadow(2px 2px 6px rgba(0,0,0,0.6));
        }

        /* Legacy img selector for backwards compatibility */
        .open-logo-topleft img:not(.nfa-logo) {
            max-width: 224px; /* Increased from 187px by 20% */
            max-height: 295px; /* Increased from 246px by 20% */
            object-fit: contain;
            filter: drop-shadow(2px 2px 6px rgba(0,0,0,0.6));
        }

        /* TOP MIDDLE: TRULY HORIZONTAL SCOREBOARD */
        /* TOP MIDDLE: DYNAMIC HORIZONTAL SCOREBOARD - SLIGHTLY LOWER */
        .scoreboard {
            position: absolute !important;
            top: 3.5vh !important; /* Moved down from 2vh */
            left: 50% !important;
            transform: translateX(-50%) !important;
            background: linear-gradient(135deg, rgba(0,10,20,0.95) 0%, rgba(5,15,25,0.95) 100%);
            border: 3px solid var(--primary-pink);
            border-radius: 15px;
            padding: 12px 24px; /* Reduced from 18px 30px */
            box-shadow: 0 8px 32px rgba(255,107,157,0.3);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            flex-direction: row !important;
            gap: 30px; /* Increased gap for better spacing */
            font-family: 'AcuminVariable', sans-serif;
            color: #FFFFFF;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            min-width: 50vw; /* Dynamic minimum width */
            max-width: 75vw; /* Maximum width constraint */
            min-height: 4vh; /* Reduced from 6.5vh */
            max-height: 5.5vh; /* Reduced from 8.3vh */
        }

        /* TEAM 1 SECTION (LEFT SIDE) - CENTERED LAYOUT */
        .team1-section {
            display: flex !important;
            align-items: center !important;
            gap: 20px;
            flex: 1;
            justify-content: center !important; /* Changed to center */
            flex-direction: row !important;
        }

        /* TEAM 2 SECTION (RIGHT SIDE) - CENTERED LAYOUT */
        .team2-section {
            display: flex !important;
            align-items: center !important;
            gap: 20px;
            flex: 1;
            justify-content: center !important; /* Changed to center */
            flex-direction: row !important;
        }

        /* TEAM 2 SECTION (RIGHT SIDE) - CENTERED LAYOUT */
        .team2-section {
            display: flex !important;
            align-items: center !important;
            gap: 20px;
            flex: 1;
            justify-content: center !important; /* Changed to center */
            flex-direction: row !important;
        }

        /* SCORE DISPLAYS - 1920x1080 OPTIMIZED */
        .team1-score, .team2-score {
            font-family: 'DayPosterBlack', sans-serif;
            font-size: 40px;
            font-weight: bold;
            color: var(--primary-yellow);
            background: rgba(255,212,61,0.1);
            border: 2px solid var(--primary-yellow);
            border-radius: 8px;
            padding: 10px 18px;
            min-width: 70px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            line-height: 1;
        }

        /* PLAYER NAMES - PERFECTLY CENTERED */
        .team1-players, .team2-players {
            font-family: 'AcuminVariable', sans-serif;
            font-size: 18px;
            font-weight: bold;
            color: #FFFFFF;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            letter-spacing: 0.3px;
            text-align: center !important; /* Force center alignment */
            line-height: 1.2;
            min-width: 200px;
            max-width: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Better spacing for widescreen */
            padding: 6px 12px;
            /* Allow text wrapping for long names */
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* SETS WON - 1920x1080 OPTIMIZED */
        .team1-sets, .team2-sets {
            font-family: 'DayPosterBlack', sans-serif;
            font-size: 22px;
            font-weight: bold;
            color: var(--primary-pink);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* CENTER SEPARATOR - BETTER POSITIONED */
        .separator {
            font-family: 'DayPosterBlack', sans-serif;
            font-size: 36px; /* Increased from 32px */
            color: var(--primary-yellow);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin: 0 25px; /* Increased from 20px */
            align-self: center;
        }

        /* Hide legacy elements */
        .team-section {
            display: none !important;
        }

        .score-display, .team-names-display, .sets-display {
            display: none !important;
        }

        .team-names-display {
            font-family: 'AcuminVariable', sans-serif;
            font-size: 16px;
            font-weight: bold;
            color: #FFFFFF;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            letter-spacing: 0.3px;
            text-align: center;
            white-space: nowrap;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sets-display {
            font-family: 'AcuminVariable', sans-serif;
            font-size: 14px;
            color: var(--primary-pink);
            font-weight: bold;
            text-align: center;
            margin-left: 8px;
        }

        /* Hide old elements */
        .team {
            display: none;
        }

        .scores-container {
            display: none;
        }

        .team-name {
            display: none;
        }

        .team-info, .score-sets-container, .score-separator {
            display: none;
        }

        .team-crest {
            display: none;
        }

        .set-info {
            position: absolute;
            top: 5vh;
            left: 2vw;
            background: rgba(0,0,0,0.8);
            border: 1px solid var(--primary-blue);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 9px;
            color: #E0E0E0;
            display: none;
        }

        .set-scores {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }

        .set-score {
            background: rgba(255,255,255,0.1);
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 8px;
            min-width: 16px;
            text-align: center;
        }

        .set-score.current {
            background: var(--primary-pink);
            color: white;
            font-weight: bold;
        }

        /* BOTTOM LEFT: LARGER HOST LOGOS (NO BACKGROUND) */
        /* BOTTOM LEFT: HOST LOGOS - ALIGNED WITH SPONSORS */
        .host-logos {
            position: absolute;
            bottom: 2vh; /* Aligned with sponsors */
            left: 2vw;
            text-align: center;
            transform: scale(1.59); /* Increased from 1.38 by 15% for SDFTV logo */
            transform-origin: bottom left;
        }

        .host-text {
            font-family: 'DayPosterBlack', sans-serif;
            font-size: 16px; /* Reduced from 22px */
            font-weight: bold;
            color: #FFFFFF;
            margin-bottom: 16px; /* Matched to sponsors spacing */
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .logos-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 29px; /* Keep existing gap */
        }

        .host-logo {
            max-width: 168px; /* Increased from 140px by 20% */
            max-height: 114px; /* Increased from 95px by 20% */
            object-fit: contain;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.6));
        }

        /* TOP RIGHT: TOURNAMENT INFO (CENTERED TEXT) */
        .tournament-info {
            position: absolute;
            top: 3.5vh; /* Moved down from 2vh */
            right: 2vw;
            background: linear-gradient(135deg, rgba(0,10,20,0.95) 0%, rgba(5,15,25,0.95) 100%); /* Same as scoreboard */
            border: 3px solid var(--primary-pink); /* Same as scoreboard */
            border-radius: 18px; /* Increased from 15px by 20% */
            padding: 22px 26px; /* Increased from 18px 22px by 20% */
            max-width: 336px; /* Increased from 280px by 20% */
            color: white;
            box-shadow: 0 8px 32px rgba(255,107,157,0.3); /* Same as scoreboard */
            backdrop-filter: blur(10px); /* Same as scoreboard */
            text-align: center; /* Center all text */
        }

        .tournament-division {
            font-family: 'DayPosterBlack', Arial, sans-serif;
            font-size: 19px; /* Increased from 16px by 20% */
            font-weight: bold;
            margin-bottom: 7px; /* Increased from 6px by 20% */
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center; /* Centered */
        }

        .tournament-details {
            font-family: 'AcuminVariable', sans-serif;
            font-size: 14px; /* Increased from 12px by 20% */
            line-height: 1.3;
            opacity: 0.95;
            text-align: center; /* Centered */
        }

        .tournament-location {
            font-size: 12px; /* Increased from 10px by 20% */
            opacity: 0.8;
            margin-top: 5px; /* Increased from 4px by 20% */
            font-style: italic;
            text-align: center; /* Centered */
        }

        /* BOTTOM RIGHT: SPONSORS - NO BACKGROUND, INCREASED BY 20% MORE */
        .sponsors-container {
            position: absolute;
            bottom: 2vh;
            right: 2vw;
            /* background: removed */
            /* border: removed */
            /* border-radius: removed */
            padding: 26px; /* Increased from 22px by 20% */
            text-align: center;
            min-width: 256px; /* Increased from 213px by 20% */
            min-height: 204px; /* Increased from 170px by 20% */
            /* box-shadow: removed */
        }

        .sponsors-title {
            font-family: 'DayPosterBlack', Arial, sans-serif;
            font-size: 30px; /* Increased from 25px by 20% */
            font-weight: bold;
            color: #FFFFFF; /* Changed to white since no background */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8); /* Added shadow for visibility */
            margin-bottom: 19px; /* Increased from 16px by 20% */
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sponsor-logo {
            max-width: 187px; /* Increased from 156px by 20% */
            max-height: 120px; /* Increased from 100px by 20% */
            object-fit: contain;
            transition: opacity 0.5s ease-in-out;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.6)); /* Added shadow for visibility */
        }

        /* CENTER OVERLAYS: REPLAY AND RANKINGS */
        .replay-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--primary-pink) 0%, var(--primary-orange) 100%);
            color: white;
            padding: 25px 50px;
            border-radius: 20px;
            font-family: 'DayPosterBlack', Arial, sans-serif;
            font-size: 32px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 12px 40px rgba(255,107,157,0.6);
            border: 3px solid rgba(255,255,255,0.3);
            display: none;
            animation: replayPulse 1.5s infinite;
        }

        @keyframes replayPulse {
            0% { 
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 12px 40px rgba(255,107,157,0.6);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.05);
                box-shadow: 0 16px 50px rgba(255,107,157,0.8);
            }
            100% { 
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 12px 40px rgba(255,107,157,0.6);
            }
        }

        /* REPLAY TRANSITION SCENE */
        .replay-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('/example_files/Bonita_cove_transition.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .replay-transition.active {
            display: flex;
            opacity: 1;
        }

        .replay-transition-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 60%;
            max-height: 60%;
            object-fit: contain;
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.7));
        }

        /* REPLAY CONTROLS */
        .replay-controls {
            position: fixed;
            top: 85%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 150;
            display: none;
            gap: 20px;
            align-items: center;
        }

        .replay-controls.active {
            display: flex;
        }

        .replay-btn {
            background: linear-gradient(135deg, var(--primary-pink) 0%, var(--primary-orange) 100%);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            color: white;
            font-family: 'DayPosterBlack', Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(255,107,157,0.4);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .replay-btn:hover {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-pink) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,107,157,0.6);
        }

        .replay-btn.primary {
            font-size: 18px;
            padding: 15px 30px;
        }

        .replay-status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0,10,20,0.95) 0%, rgba(5,15,25,0.95) 100%);
            border: 3px solid var(--primary-pink);
            border-radius: 15px;
            padding: 20px 30px;
            color: white;
            font-family: 'AcuminVariable', sans-serif;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            z-index: 200;
            display: none;
            box-shadow: 0 8px 32px rgba(255,107,157,0.3);
            backdrop-filter: blur(10px);
        }

        .replay-status.active {
            display: block;
        }

        .rankings-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--dark-bg) 0%, rgba(0,0,0,0.95) 100%);
            border: 4px solid var(--primary-yellow);
            border-radius: 18px;
            padding: 25px;
            max-width: 380px;
            display: none;
            box-shadow: 0 12px 50px rgba(0,0,0,0.8);
        }

        .rankings-title {
            font-family: 'DayPosterBlack', Arial, sans-serif;
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-yellow);
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .rankings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .rankings-table th {
            background: var(--primary-pink);
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-family: 'AcuminVariable', sans-serif;
            font-weight: bold;
            border-bottom: 2px solid var(--primary-yellow);
            font-size: 12px;
            text-transform: uppercase;
        }

        .rankings-table td {
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            color: #E0E0E0;
            font-family: 'AcuminVariable', sans-serif;
            font-size: 12px;
        }

        .rankings-table tr:nth-child(even) {
            background: rgba(255,255,255,0.05);
        }

        /* Highlight top 3 positions */
        .rankings-table .position-1 {
            background: linear-gradient(90deg, var(--primary-yellow), transparent);
        }

        .rankings-table .position-2 {
            background: linear-gradient(90deg, var(--primary-blue), transparent);
        }

        .rankings-table .position-3 {
            background: linear-gradient(90deg, var(--primary-orange), transparent);
        }

        /* ANIMATIONS */
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        .fade-out {
            animation: fadeOut 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0) scale(1); }
            to { opacity: 0; transform: translateY(-20px) scale(0.95); }
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 1280px) {
            .scoreboard {
                padding: 14px 18px;
                min-width: 500px;
                gap: 16px;
            }
            
            .open-logo-img {
                width: 50px;
                height: 65px;
            }
            
            .team-score {
                font-size: 28px;
                min-width: 45px;
            }
            
            .player-names {
                font-size: 13px;
                max-width: 130px;
            }
            
            .team-sets {
                font-size: 11px;
                min-width: 18px;
            }
            
            .team-crest {
                width: 22px;
                height: 22px;
                font-size: 9px;
            }
            
            .host-text {
                font-size: 22px;
            }
            
            .host-logo {
                max-width: 95px;
                max-height: 63px;
            }
            
            .sponsors-container {
                padding: 16px;
                min-width: 120px;
                min-height: 95px;
            }
            
            .sponsors-title {
                font-size: 14px;
            }
            
            .sponsor-logo {
                max-width: 88px;
                max-height: 56px;
            }
        }

        @media (max-width: 800px) {
            .scoreboard {
                min-width: 400px;
                gap: 12px;
            }
            
            .team-score {
                font-size: 24px;
                min-width: 40px;
            }
            
            .player-names {
                font-size: 12px;
                max-width: 100px;
            }
            
            .open-logo-img {
                width: 40px;
                height: 55px;
            }
        }

        /* UTILITY CLASSES */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .flex-visible {
            display: flex !important;
        }

        /* LOADING STATE */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--primary-pink);
            font-family: 'AcuminVariable', sans-serif;
            font-size: 16px;
            text-align: center;
            background: var(--dark-bg);
            padding: 18px 25px;
            border-radius: 12px;
            border: 2px solid var(--primary-pink);
        }
    </style>
</head>
<body>
    <div class="overlay-container">
        <!-- LOADING STATE -->
        <div class="loading" id="loading-indicator">
            🔄 Connecting to San Diego Footvolley Open control...
        </div>

        <!-- TOP LEFT: OPEN LOGO + NFA LOGO -->
        <div class="open-logo-topleft">
            <img src="/logos/OPEN_SDFTV_white_logo.png" alt="OPEN SDFTV" class="open-logo" />
            <img src="/logos/NFA_logo.png" alt="NFA" class="nfa-logo" />
        </div>

        <!-- CENTER: HORIZONTAL SCOREBOARD -->
        <!-- TEAM 1 LEFT | SEPARATOR | TEAM 2 RIGHT -->
        <div class="scoreboard" id="scoreboard">
            <!-- TEAM 1 SECTION (LEFT) -->
            <div class="team1-section">
                <span class="team1-score" id="team1-score">0</span>
                <span class="team1-players" id="team1-players">Player 1A<br><span style="font-size:18px;">&</span><br>Player 1B</span>
                <span class="team1-sets" id="team1-sets">(0)</span>
            </div>
            
            <!-- CENTER SEPARATOR -->
            <span class="separator">|</span>
            
            <!-- TEAM 2 SECTION (RIGHT) -->
            <div class="team2-section">
                <span class="team2-sets" id="team2-sets">(0)</span>
                <span class="team2-players" id="team2-players">Player 2A<br><span style="font-size:18px;">&</span><br>Player 2B</span>
                <span class="team2-score" id="team2-score">0</span>
            </div>
        </div>

        <!-- LEGACY STRUCTURE (HIDDEN) -->
        <div style="display: none;">
            <div class="scores-container">
                <div class="team">
                    <div class="team-info">
                        <div class="team-crest" id="team1-crest">1</div>
                        <div class="team-name" id="team1-name">TEAM1</div>
                    </div>
                    <div class="score-sets-container"></div>
                </div>
                <div class="team">
                    <div class="team-info">
                        <div class="team-crest" id="team2-crest">2</div>
                        <div class="team-name" id="team2-name">TEAM2</div>
                    </div>
                    <div class="score-sets-container"></div>
                </div>
            </div>
        </div>

        <!-- SET INFO (SEPARATE ELEMENT) -->
        <div class="set-info" id="set-info">
            <div id="set-current">Set 1 of 3</div>
            <div class="set-scores" id="set-scores-display">
                <!-- Set scores will be populated here -->
            </div>
        </div>

        <!-- BOTTOM LEFT: HOST LOGOS (SDFTV ONLY) -->
        <div class="host-logos" id="host-logos">
            <div class="host-text">Hosted by</div>
            <div class="logos-container">
                <img src="/logos/SDFTV logo.png" alt="San Diego Footvolley" class="host-logo">
            </div>
        </div>

        <!-- TOP RIGHT: TOURNAMENT INFO -->
        <div class="tournament-info" id="tournament-info">
            <div class="tournament-division" id="tournament-division">OPEN DIVISION</div>
            <div class="tournament-details" id="tournament-details">
                <div id="tournament-round">Quarter Finals - Match 1</div>
                <div class="tournament-location" id="tournament-location">Mission Bay, San Diego - CA</div>
            </div>
        </div>

        <!-- BOTTOM RIGHT: SPONSORS -->
        <div class="sponsors-container" id="sponsors-container">
            <div class="sponsors-title">Sponsors</div>
            <img src="/sponsors/plex-logo.svg" alt="Sponsor" class="sponsor-logo" id="sponsor-logo">
        </div>

        <!-- CENTER: REPLAY INDICATOR -->
        <div class="replay-indicator" id="replay-indicator">
            🔄 Replay
        </div>

        <!-- REPLAY SYSTEM -->
        <!-- Transition Scene -->
        <div class="replay-transition" id="replay-transition">
            <img src="/logos/OPEN_SDFTV_grey_logo.png" alt="OPEN SDFTV" class="replay-transition-logo" />
        </div>

        <!-- Replay Controls -->
        <div class="replay-controls" id="replay-controls">
            <button class="replay-btn primary" id="start-replay-btn">🎬 Start Replay</button>
            <button class="replay-btn" id="skip-replay-btn">⏭️ Skip to Live</button>
        </div>

        <!-- Replay Status -->
        <div class="replay-status" id="replay-status">
            <div id="replay-status-text">Preparing replay...</div>
        </div>

        <!-- CENTER: RANKINGS TABLE -->
        <div class="rankings-container" id="rankings-container">
            <div class="rankings-title">🏆 Tournament Rankings</div>
            <table class="rankings-table">
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Team</th>
                        <th>Wins</th>
                        <th>Points</th>
                    </tr>
                </thead>
                <tbody id="rankings-content">
                    <!-- Rankings will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Socket.IO for real-time communication -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        /**
         * SAN DIEGO FOOTVOLLEY OPEN - OVERLAY JAVASCRIPT
         * 
         * Handles real-time updates with tournament branding and sponsor rotation
         */
        
        // Connect to server for real-time updates
        const socket = io();
        
        // Get references to all overlay elements
        const elements = {
            loading: document.getElementById('loading-indicator'),
            scoreboard: document.getElementById('scoreboard'),
            
            // Team elements - updated for player names
            team1Players: document.getElementById('team1-players'),
            team1Score: document.getElementById('team1-score'),
            team1Sets: document.getElementById('team1-sets'),
            team1Name: document.getElementById('team1-name'),
            
            team2Players: document.getElementById('team2-players'),
            team2Score: document.getElementById('team2-score'),
            team2Sets: document.getElementById('team2-sets'),
            team2Name: document.getElementById('team2-name'),
            
            // Tournament elements
            setInfo: document.getElementById('set-info'),
            setCurrent: document.getElementById('set-current'),
            setScoresDisplay: document.getElementById('set-scores-display'),
            tournamentDivision: document.getElementById('tournament-division'),
            tournamentDetails: document.getElementById('tournament-details'),
            tournamentRound: document.getElementById('tournament-round'),
            tournamentLocation: document.getElementById('tournament-location'),
            
            // Interactive elements
            replayIndicator: document.getElementById('replay-indicator'),
            rankingsContainer: document.getElementById('rankings-container'),
            rankingsContent: document.getElementById('rankings-content'),
            sponsorLogo: document.getElementById('sponsor-logo'),
            sponsorsContainer: document.getElementById('sponsors-container'),
            
            // Replay system elements
            replayTransition: document.getElementById('replay-transition'),
            replayControls: document.getElementById('replay-controls'),
            replayStatus: document.getElementById('replay-status'),
            replayStatusText: document.getElementById('replay-status-text'),
            startReplayBtn: document.getElementById('start-replay-btn'),
            skipReplayBtn: document.getElementById('skip-replay-btn')
        };
        
        // Store current game state and sponsors
        let currentGameState = {};
        let sponsors = [];
        let currentSponsorIndex = 0;
        let sponsorRotationInterval;
        
        // Replay system variables (simplified)
        let replayState = {
            isActive: false,
            returnTimer: null
        };
        
        /**
         * CONNECTION HANDLING
         */
        socket.on('connect', () => {
            console.log('✅ San Diego Footvolley Open overlay connected');
            elements.loading.style.display = 'none';
            elements.scoreboard.style.display = 'block';
            
            // Load sponsors and start rotation
            loadSponsors();
        });
        
        socket.on('disconnect', () => {
            console.log('❌ Overlay disconnected from server');
            elements.loading.style.display = 'block';
            elements.loading.textContent = '❌ Connection lost - Reconnecting...';
        });
        
        /**
         * TOURNAMENT INFO UPDATES
         * Handle tournament info updates from control panel
         */
        socket.on('tournamentInfoUpdate', (data) => {
            console.log('🏆 Tournament info update received:', data);
            updateTournamentDisplay(data);
        });
        
        /**
         * SETS MODE UPDATES
         * Handle sets mode toggle from control panel
         */
        socket.on('setsModeUpdate', (data) => {
            console.log('📊 Sets mode update received:', data);
            updateSetsDisplay(data.enabled);
        });
        
        /**
         * GAME STATE UPDATES
         */
        socket.on('gameStateUpdate', (gameState) => {
            console.log('📊 Overlay received update:', gameState);
            currentGameState = gameState;
            updateOverlay();
        });
        
        /**
         * UPDATE TOURNAMENT DISPLAY
         * Apply tournament info updates from control panel
         */
        function updateTournamentDisplay(data) {
            const tournamentDivision = document.getElementById('tournament-division');
            const tournamentRound = document.getElementById('tournament-round');
            const tournamentLocation = document.getElementById('tournament-location');
            
            if (tournamentDivision) {
                tournamentDivision.textContent = data.division || 'OPEN DIVISION';
            }
            
            if (tournamentRound) {
                tournamentRound.textContent = `${data.round || 'Quarter Finals'} - Match ${data.matchNumber || '1'}`;
            }
            
            if (tournamentLocation) {
                tournamentLocation.textContent = data.location || 'Mission Bay, San Diego - CA';
            }
            
            console.log('🏆 Tournament display updated');
        }
        
        /**
         * UPDATE SETS DISPLAY
         * Show/hide sets information based on sets mode
         */
        function updateSetsDisplay(enabled) {
            const team1Sets = document.getElementById('team1-sets');
            const team2Sets = document.getElementById('team2-sets');
            const matchInfoMini = document.querySelector('.match-info-mini');
            
            if (team1Sets && team2Sets) {
                team1Sets.style.display = enabled ? 'block' : 'none';
                team2Sets.style.display = enabled ? 'block' : 'none';
            }
            
            if (matchInfoMini) {
                matchInfoMini.style.display = enabled ? 'block' : 'none';
            }
            
            console.log('📊 Sets display:', enabled ? 'shown' : 'hidden');
        }
        
        /**
         * UPDATE OVERLAY DISPLAY
         */
        function updateOverlay() {
            const state = currentGameState;
            
            updateTeamInfo(state);
            updateSetScores(state);
            updateTournamentInfo(state);
            handleReplayDisplay(state);
            handleRankingsDisplay(state);
            handlePlayerNamesDisplay(state);
        }
        
        /**
         * UPDATE TEAM INFORMATION
         */
        function updateTeamInfo(state) {
            const scoreboard = document.querySelector('.scoreboard');
            let hasStackedNames = false;
            
            if (state.team1) {
                // Display player names instead of team name
                if (state.team1.players && state.team1.players.length >= 2) {
                    const player1 = state.team1.players[0] || 'Player 1';
                    const player2 = state.team1.players[1] || 'Player 2';
                    
                    // Format names with line breaks if they're long
                    const combinedLength = player1.length + player2.length;
                    if (combinedLength > 20) {
                        elements.team1Players.innerHTML = `${player1}<br><span style="font-size:18px;">&</span><br>${player2}`;
                        hasStackedNames = true;
                    } else {
                        elements.team1Players.textContent = `${player1} & ${player2}`;
                    }
                } else {
                    elements.team1Players.textContent = state.team1.name || 'Team 1';
                }
                
                elements.team1Score.textContent = state.team1.score || 0;
                elements.team1Sets.textContent = `(${state.team1.setsWon || 0})`;
            }
            
            if (state.team2) {
                // Display player names instead of team name
                if (state.team2.players && state.team2.players.length >= 2) {
                    const player1 = state.team2.players[0] || 'Player 3';
                    const player2 = state.team2.players[1] || 'Player 4';
                    
                    // Format names with line breaks if they're long
                    const combinedLength = player1.length + player2.length;
                    if (combinedLength > 20) {
                        elements.team2Players.innerHTML = `${player1}<br><span style="font-size:18px;">&</span><br>${player2}`;
                        hasStackedNames = true;
                    } else {
                        elements.team2Players.textContent = `${player1} & ${player2}`;
                    }
                } else {
                    elements.team2Players.textContent = state.team2.name || 'Team 2';
                }
                
                elements.team2Score.textContent = state.team2.score || 0;
                elements.team2Sets.textContent = `(${state.team2.setsWon || 0})`;
            }
            
            // Adjust scoreboard size based on whether names are stacked
            if (hasStackedNames) {
                scoreboard.style.minHeight = '5.5vh'; /* Reduced from 8vh */
                scoreboard.style.maxHeight = '7vh'; /* Reduced from 10vh */
                scoreboard.style.minWidth = '55vw';
            } else {
                scoreboard.style.minHeight = '4vh'; /* Reduced from 6.5vh */
                scoreboard.style.maxHeight = '5.5vh'; /* Reduced from 8.3vh */
                scoreboard.style.minWidth = '50vw';
            }
        }
        
        /**
         * UPDATE SET SCORES
         */
        function updateSetScores(state) {
            if (!state.setScores || state.currentSet === 1) {
                elements.setInfo.style.display = 'none';
                return;
            }
            
            elements.setCurrent.textContent = `Set ${state.currentSet} of ${state.maxSets}`;
            
            let html = '';
            for (let i = 0; i < state.maxSets; i++) {
                const team1Score = state.setScores.team1[i] || 0;
                const team2Score = state.setScores.team2[i] || 0;
                const isCurrentSet = (i + 1) === state.currentSet;
                
                if (team1Score > 0 || team2Score > 0 || isCurrentSet) {
                    html += `<div class="set-score ${isCurrentSet ? 'current' : ''}">${team1Score}-${team2Score}</div>`;
                }
            }
            
            elements.setScoresDisplay.innerHTML = html;
            elements.setInfo.style.display = 'block';
        }
        
        /**
         * UPDATE TOURNAMENT INFO
         */
        function updateTournamentInfo(state) {
            if (state.tournament) {
                elements.tournamentDivision.textContent = state.tournament.division || 'Open Division';
                
                const roundText = state.tournament.round || 'Match';
                const matchNumber = state.tournament.matchNumber || 1;
                elements.tournamentRound.textContent = `${roundText} - Match ${matchNumber}`;
                
                elements.tournamentLocation.textContent = state.tournament.location || 'Mission Bay, San Diego - CA';
            }
        }
        
        /**
         * HANDLE REPLAY DISPLAY
         */
        function handleReplayDisplay(state) {
            if (state.showReplay) {
                elements.replayIndicator.classList.add('visible');
                elements.replayIndicator.classList.add('fade-in');
                
                setTimeout(() => {
                    elements.replayIndicator.classList.remove('visible');
                    elements.replayIndicator.classList.remove('fade-in');
                }, 4500);
            }
        }
        
        /**
         * HANDLE RANKINGS DISPLAY
         */
        function handleRankingsDisplay(state) {
            if (state.showRankings) {
                fetchAndDisplayRankings();
            } else {
                elements.rankingsContainer.classList.remove('visible');
            }
        }
        
        /**
         * HANDLE PLAYER NAMES VS TEAM NAMES
         */
        function handlePlayerNamesDisplay(state) {
            // Always show player names, never team names in this design
            elements.team1Players.style.display = 'block';
            elements.team2Players.style.display = 'block';
            elements.team1Name.style.display = 'none';
            elements.team2Name.style.display = 'none';
        }
        
        /**
         * SPONSOR ROTATION SYSTEM
         */
        async function loadSponsors() {
            try {
                const response = await fetch('/api/sponsors');
                const data = await response.json();
                
                if (data.sponsors && data.sponsors.length > 0) {
                    // Filter to only use .png files
                    sponsors = data.sponsors.filter(sponsor => 
                        sponsor.endsWith('.png') || sponsor.endsWith('.jpeg')
                    );
                    
                    if (sponsors.length === 0) {
                        // Fallback to actual sponsor files
                        sponsors = [
                            '/sponsors/PLEX_sponsor.png',
                            '/sponsors/23web_sponsor.png',
                            '/sponsors/acai_carioca_sponsor.png',
                            '/sponsors/caffeine_army_sponsor.png',
                            '/sponsors/ftv_shop_sponsor.png',
                            '/sponsors/babe_kombucha_sponsor.jpeg'
                        ];
                    }
                    
                    startSponsorRotation();
                } else {
                    // Use actual sponsor files as default
                    sponsors = [
                        '/sponsors/PLEX_sponsor.png',
                        '/sponsors/23web_sponsor.png',
                        '/sponsors/acai_carioca_sponsor.png',
                        '/sponsors/caffeine_army_sponsor.png',
                        '/sponsors/ftv_shop_sponsor.png',
                        '/sponsors/babe_kombucha_sponsor.jpeg'
                    ];
                    startSponsorRotation();
                }
            } catch (error) {
                console.log('⚠️ Could not load sponsors, using defaults');
                sponsors = [
                    '/sponsors/PLEX_sponsor.png',
                    '/sponsors/23web_sponsor.png',
                    '/sponsors/acai_carioca_sponsor.png'
                ];
                elements.sponsorLogo.src = sponsors[0];
            }
        }
        
        function startSponsorRotation() {
            if (sponsors.length <= 1) return;
            
            // Clear any existing interval
            if (sponsorRotationInterval) {
                clearInterval(sponsorRotationInterval);
            }
            
            // Start rotating sponsors every 5 seconds
            sponsorRotationInterval = setInterval(() => {
                currentSponsorIndex = (currentSponsorIndex + 1) % sponsors.length;
                
                // Fade out current sponsor
                elements.sponsorLogo.style.opacity = '0';
                
                // Change sponsor after fade out
                setTimeout(() => {
                    elements.sponsorLogo.src = sponsors[currentSponsorIndex];
                    elements.sponsorLogo.style.opacity = '1';
                }, 250);
                
            }, 5000);
            
            // Set initial sponsor
            elements.sponsorLogo.src = sponsors[0];
        }
        
        /**
         * FETCH AND DISPLAY RANKINGS
         */
        async function fetchAndDisplayRankings() {
            try {
                console.log('📊 Fetching tournament rankings...');
                
                const response = await fetch('/api/rankings');
                const data = await response.json();
                
                if (data.error) {
                    console.log('⚠️ Rankings not available:', data.message);
                    displayPlaceholderRankings();
                    return;
                }
                
                if (data.data && data.data.length > 0) {
                    displayRankings(data.data);
                } else {
                    displayPlaceholderRankings();
                }
                
                // Show rankings with animation
                elements.rankingsContainer.classList.add('visible');
                elements.rankingsContainer.classList.add('fade-in');
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    elements.rankingsContainer.classList.remove('visible');
                    elements.rankingsContainer.classList.remove('fade-in');
                }, 10000);
                
            } catch (error) {
                console.error('❌ Error fetching rankings:', error);
                displayPlaceholderRankings();
            }
        }
        
        /**
         * DISPLAY RANKINGS DATA
         */
        function displayRankings(rankingsData) {
            let html = '';
            
            rankingsData.slice(1).forEach((row, index) => {
                const position = index + 1;
                const team = row[0] || `Team ${position}`;
                const wins = row[1] || '0';
                const points = row[2] || '0';
                
                html += `
                    <tr class="position-${position}">
                        <td>${position}</td>
                        <td>${team}</td>
                        <td>${wins}</td>
                        <td>${points}</td>
                    </tr>
                `;
            });
            
            elements.rankingsContent.innerHTML = html;
            console.log('📊 Rankings displayed successfully');
        }
        
        /**
         * DISPLAY PLACEHOLDER RANKINGS
         */
        function displayPlaceholderRankings() {
            const placeholderData = [
                ['Beach Legends', '3', '9'],
                ['Sand Warriors', '2', '6'],
                ['Spike Masters', '2', '6'],
                ['Net Ninjas', '1', '3'],
                ['Serve Aces', '0', '0']
            ];
            
            let html = '';
            placeholderData.forEach((team, index) => {
                const position = index + 1;
                html += `
                    <tr class="position-${position}">
                        <td>${position}</td>
                        <td>${team[0]}</td>
                        <td>${team[1]}</td>
                        <td>${team[2]}</td>
                    </tr>
                `;
            });
            
            elements.rankingsContent.innerHTML = html;
            console.log('📊 Placeholder rankings displayed');
        }
        
        /**
         * INITIALIZE OVERLAY
         */
        function initializeOverlay() {
            console.log('🏐 San Diego Footvolley Open overlay initialized');
            console.log('📺 Waiting for referee control updates...');
            
            setTimeout(() => {
                if (socket.connected) {
                    elements.loading.style.display = 'none';
                    elements.scoreboard.style.display = 'block';
                }
            }, 2000);
        }
        
        /**
         * REPLAY SYSTEM FOR OBS INTEGRATION
         */
        
        // Setup replay system event listeners
        function initializeReplaySystem() {
            // Trigger replay button
            elements.startReplayBtn.addEventListener('click', triggerReplaySequence);
            
            // Skip replay button
            elements.skipReplayBtn.addEventListener('click', skipToLive);
            
            // Listen for replay trigger from control panel
            socket.on('trigger-replay', () => {
                triggerReplaySequence();
            });
            
            // Listen for skip replay from control panel
            socket.on('skip-replay', () => {
                skipToLive();
            });
        }
        
        // Trigger replay sequence (simplified for your OBS setup)
        function triggerReplaySequence() {
            if (replayState.isActive) return;
            
            console.log('🎬 Starting replay sequence');
            replayState.isActive = true;
            
            // Show replay controls and status
            showReplayControls();
            showReplayStatus('Press Ctrl+R now, then switch to Replay_Scene in OBS');
            
            // Signal scene change to Replay_Scene (if OBS WebSocket configured)
            console.log('📺 Signaling switch to Replay_Scene');
            socket.emit('obs-change-scene', 'Replay_Scene');
            
            // Auto-return to Main_Camera after 20 seconds (your replay duration)
            replayState.returnTimer = setTimeout(() => {
                console.log('⏰ Auto-returning to live after 20 seconds');
                returnToMainCamera();
            }, 20000);
        }
        
        // Show transition scene with Bonita Cove background
        function showTransitionScene() {
            console.log('🌄 Showing transition scene');
            replayState.isInTransition = true;
            
            elements.replayTransition.classList.add('active');
            
            // Send signal to OBS (if WebSocket is configured)
            socket.emit('obs-change-scene', 'Replay_Transition');
            
            showReplayStatus('Preparing replay...');
        }
        
        // Hide transition scene
        function hideTransitionScene() {
            console.log('🌄 Hiding transition scene');
            replayState.isInTransition = false;
            
            elements.replayTransition.classList.remove('active');
        }
        
        // Show replay controls
        function showReplayControls() {
            elements.replayControls.classList.add('active');
        }
        
        // Hide replay controls
        function hideReplayControls() {
            elements.replayControls.classList.remove('active');
        }
        
        // Show replay status
        function showReplayStatus(message) {
            elements.replayStatusText.textContent = message;
            elements.replayStatus.classList.add('active');
        }
        
        // Hide replay status
        function hideReplayStatus() {
            elements.replayStatus.classList.remove('active');
        }
        
        // Start replay sequence
        function startReplaySequence() {
            console.log('▶️ Starting replay sequence');
            
            hideTransitionScene();
            showReplayStatus('Playing replay... Use OBS replay source');
            
            // Signal OBS to switch to replay scene
            socket.emit('obs-change-scene', 'Replay_Scene');
            
            // Auto-return to live after replay duration
            setTimeout(() => {
                returnToLive();
            }, replayState.replayDuration);
        }
        
        // Skip to live feed immediately
        function skipToLive() {
            if (!replayState.isActive) return;
            
            console.log('⏭️ Skipping replay - returning to live immediately');
            
            // Clear auto-return timer
            if (replayState.returnTimer) {
                clearTimeout(replayState.returnTimer);
                replayState.returnTimer = null;
            }
            
            returnToMainCamera();
        }
        
        // Return to main camera
        function returnToMainCamera() {
            console.log('📺 Returning to Main_Camera');
            
            hideReplayControls();
            hideReplayStatus();
            
            replayState.isActive = false;
            
            // Signal scene change to Main_Camera
            socket.emit('obs-change-scene', 'Main_Camera');
        }
        
        // Handle OBS scene changes (if OBS WebSocket is configured)
        function handleOBSSceneChange(sceneName) {
            console.log('🎬 OBS Scene changed to:', sceneName);
            
            if (sceneName === 'Main_Camera' && replayState.isActive) {
                returnToLive();
            }
        }
        
        // Add keyboard shortcuts for replay control
        function setupReplayKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Only process if focused on the overlay
                if (document.activeElement === document.body) {
                    switch(e.key) {
                        case 'r':
                        case 'R':
                            if (!replayState.isActive) {
                                triggerReplay();
                            }
                            break;
                        case 's':
                        case 'S':
                            if (replayState.isActive) {
                                skipToLive();
                            }
                            break;
                        case 'Escape':
                            if (replayState.isActive) {
                                returnToLive();
                            }
                            break;
                    }
                }
            });
        }
        
        // Start the overlay when page loads
        function initializeOverlay() {
            console.log('🏐 San Diego Footvolley Open Overlay Loading...');
            
            // Initialize replay system
            initializeReplaySystem();
            setupReplayKeyboardShortcuts();
            
            setTimeout(() => {
                if (socket.connected) {
                    elements.loading.style.display = 'none';
                    elements.scoreboard.style.display = 'block';
                }
            }, 2000);
        }
        
        initializeOverlay();
        
        // Error handling
        window.addEventListener('error', (e) => {
            console.error('❌ Overlay error:', e.error);
        });
        
        // Prevent context menu and interactions
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        document.addEventListener('selectstart', (e) => e.preventDefault());
        document.addEventListener('dragstart', (e) => e.preventDefault());
    </script>
</body>
</html>
